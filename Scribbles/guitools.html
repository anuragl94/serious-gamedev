<html>

<style>
.points {
	position: absolute;
	border: 4px solid blue;
	border-radius: 8px;
	width: 8px;
	height: 8px;
}

#baseLine {
	position: absolute;
	background-color: blue;
	height: 3px;
	width: 200px;
}

#perpendicularLine {
	position: absolute;
	background-color: red;
	height: 1px;
	width: 600px;
}

#parallelLine {
	position: absolute;
}

.optionWrapper {
	display: inline-block;
	position: absolute;
	top:0;
	left:0;
}

.canvasOverlay {
	position: absolute;
	z-index: 1;
}

.imageUnderlay {
	position: relative;
	height: 400px;
	z-index: 1;
}

.vertex {
	position: relative;
	z-index: 1;
}
</style>

<head>
<script src="jquery-1.12.0.min.js"></script>
</head>

<body>

<div class="optionWrapper">
<canvas class="canvasOverlay" height="400px" width="400px"></canvas>
<object type="image/svg+xml" data="svg\6C Simple.svg" id="option1"></object>
</div>

<br>
X: <p id="mouse_x">0</p>
Y: <p id="mouse_y">0</p>

<script>
	// This code will extract coordinates from the svg file as intended.
	// Please note that jquery only parses HTML DOM and not SVG DOM. Hence, query selector will never work on the object tag, no matter what. So don't try optimizing code over there.
	//Thoughts: Would it be okay to get the svg object document content and replace the object with the svg code in the content itself? This can be done in the module that renders the options onto the gamescreen.
$(window).load(function() {
	var coordinates = {};
	
	$(".optionWrapper").append('<img src="'+document.getElementById('option1').data+'" class="imageUnderlay" id="option1"/>');
	$(".canvasOverlay").each(function(){
		var svgObject = document.getElementById('option1').contentDocument;
		var paths = $(svgObject).find("path");	// Common to all the tools one can usemap
		
		//Following will be the regex to filter exact coordinates from the path
		//Inkscape
		
		//Adobe Illustrator
		
		//Geogebra
		//NOTE: This seems to be wrong, as it's only extracting the bounding box
		//var coords = $($(svgObject).find("svg g g g path")[0]).attr("d");
		//coords = coords.match(/[MLHVCSQTAZ] [0-9.]+ [0-9.]+/g);
		//coordinates['option1'] = $.map(coords, function(value) {
		//    var temp = value.split(' ');
		//    return [[temp[1],temp[2]]];
		//});
		
		//Super minified
		var coords = $($(svgObject).find("svg path")[0]).attr("d");
		coords = coords.match(/[MLHVCSQTAZ] [0-9.]+ [0-9.]+/g);
		coordinates['option1'] = $.map(coords, function(value) {
			var temp = value.split(' ');
			return [[temp[1],temp[2]]];
		});
	
		//Tool specific code ends here
		var underlay = $(this).closest(".objectWrapper").find("img");
	});
	
	$("object").remove();
	
    console.log(coordinates);
	
    function angle(cx, cy, ex, ey) {
        var dy = ey - cy;
        var dx = ex - cx;
        var svgObject = Math.atan2(dy, dx); // range (-PI, PI]
        svgObject *= 180 / Math.PI; // rads to degs, range (-180, 180]
        //if (svgObject < 0) svgObject = 360 + svgObject; // range [0, 360)
        return svgObject;
    }

    $(document).on("click", function() {
        if ($("#point1").length == 0) {
            point1 = document.createElement("div");
            $(point1).addClass("points");
            $(point1).attr("id", "point1");
            $(point1).css({
                "left": event.pageX,
                "top": event.pageY
            });
            $(point1).attr("coord-x", event.pageX);
            $(point1).attr("coord-y", event.pageY);
            document.body.appendChild(point1);
        } else if ($("#point2").length == 0) {
            point2 = document.createElement("div");
            $(point2).addClass("points");
            $(point2).attr("id", "point2");
            $(point2).css({
                "left": event.pageX,
                "top": event.pageY
            });
            $(point2).attr("coord-x", event.pageX);
            $(point2).attr("coord-y", event.pageY);
            document.body.appendChild(point2);

            baseLine = document.createElement("div");
            $(baseLine).attr("id", "baseLine");
            mouseangle = angle($(point1).attr("coord-x"), $(point1).attr("coord-y"), $(point2).attr("coord-x"), $(point2).attr("coord-y"));
            $(baseLine).css({
                '-webkit-transform': 'rotate(' + mouseangle + 'deg)',
                "left": $(point1).attr("coord-x"),
                "top": $(point1).attr("coord-y")
            });
            document.body.appendChild(baseLine);

            perpendicularLine = document.createElement("div");
            $(perpendicularLine).attr("id", "perpendicularLine");
            mouseangle = angle($(point1).attr("coord-x"), $(point1).attr("coord-y"), $(point2).attr("coord-x"), $(point2).attr("coord-y"));
            $(perpendicularLine).css({
                '-webkit-transform': 'rotate(' + (90 + mouseangle) + 'deg)'
            });
            document.body.appendChild(perpendicularLine);
        } else {
            $("#point1").remove();
            $("#point2").remove();
            $("#baseLine").remove();
            $("#perpendicularLine").remove();
        }
    });

    $(document).mousemove(function() {
		$("#mouse_x").html(event.pageX);
		$("#mouse_y").html(event.pageY);
        if ($("#perpendicularLine").length) {
            $("#perpendicularLine").attr("coord-x", event.pageX);
            $("#perpendicularLine").attr("coord-y", event.pageY);
            $("#perpendicularLine").css({
                "left": event.pageX,
                "top": event.pageY
            });
        }
    });
});
</script>

</body>

</html>